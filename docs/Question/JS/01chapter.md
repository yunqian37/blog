# JS运行机制

**进程：** 系统分配的独立资源，是CPU资源分配的基本单位，进程是由一个或多个线程组成的。

**线程：** 进程的执行流，是CPU调度和分派的基本单位，同个进程之中的多个线程之间是共享该进程的资源的

### 浏览器内核

浏览器是多进程的，浏览器每一个tab标签都代表一个独立的进程（多个空白tab标签会合并成一个进程），浏览器内核（浏览器渲染进程）属于浏览器多进程的一种

**浏览器内核的多种线程：**

+ GUI渲染线程：
  + 负责渲染页面，解析HTML、Css构成DOM树等，当页面重绘或者由于某种操作引起回流都会调起该线程。
  + 和JS引擎线程是互斥的，当JS引擎线程在工作的时候，GUI渲染线程会被挂起，GUI更新被放入在JS任务队列中，等待JS引擎线程空闲的时候继续执行
+ JS引擎线程：
  + 单线程工作，负责解析运行JS脚本
  + 和GUI渲染线程互斥，JS运行耗时过长就会导致页面阻塞
+ 事件触发线程：
  + 当事件符合触发条件被触发时，该线程会把对应的事件回调函数添加到任务队列的队尾，等待JS引擎处理
+ http请求线程：
  + http请求的时候会开启一条请求线程
  + 请求完成有结果了之后将请求的回调函数添加到任务队列中，等待JS引擎处理

### Js引擎是单线程

每次只能执行一项任务，其他任务都得按照顺序排队等待被执行，只有当前的任务执行完成之后才会继续执行下一个任务

### JS事件循环机制

+ 浏览器循环机制：是HTML中定义的规范
+ Node事件循环机制：是有libuv库实现

js有一个main thread主线程和call-stack调用栈（执行栈），所有的任务都会被放到调用栈等待主线程执行

+ **JS调用栈：** 一种后进先出的数据结构，当函数被调用时，会被添加到栈中的顶部，执行完成之后就从栈顶部移出该函数，直到栈内被清空
+ **同步任务：** js单线程中的任务被分为同步任务和异步任务，同步任务会在调用栈中按照顺序排队等待主线程执行
+ **异步任务：** 会在异步有了结果后将注册的回调函数添加到任务队列中等待主线程空闲的时候（即栈内被清空的时候）被读取到栈中等待主线程执行。**任务队列是先进先出的数据结构**
+ **Event Loop：** 调用栈中的同步任务都执行完毕，栈内被清空了就代表主线程空闲了。这个时候就会去任务队列中按照顺序读取一个任务放入到栈中执行。每次栈内被清空都会去读取任务队列有没有任务，有就读取执行，一直循环读取执行的操作就形成了事件循环

js是一门单线程语言，Event Loop是JS的执行机制


